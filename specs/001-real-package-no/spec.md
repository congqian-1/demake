# 功能规格说明：板件真实包号

**功能分支**：`001-real-package-no`  
**创建日期**：2026-02-03  
**状态**：草稿  
**输入**：用户描述："新增一个需求，板块的表格增加一个真是打包的包号的字段，submitWorkReport接口增加入参，到时候入库这个状态，并且在queryWorkOrderAndBatch、queryPackage、queryDetail的板块实体也返回这字段"

## 用户场景与测试（必须）

### 用户故事 1 - 报工记录真实包号（优先级：P1）

产线操作员在板件报工时录入真实打包的包号，系统保存该信息用于后续追溯与查询。

**优先级原因**：真实包号是新增核心业务数据，必须先保证可被录入与保存。

**独立测试**：提交报工时携带真实包号，验证板件记录中真实包号被保存。

**验收场景**：

1. **给定** 板件存在且可报工，**当** 报工提交包含真实包号，**则** 系统保存该真实包号到板件记录
2. **给定** 板件存在且可报工，**当** 报工提交未包含真实包号，**则** 系统不修改已有真实包号（如无则保持为空）

---

### 用户故事 2 - 查询返回真实包号（优先级：P2）

质检或追溯人员通过板件查询接口获取板件层级信息时，可以看到真实包号字段。

**优先级原因**：真实包号的价值体现在查询与追溯，需要在主要查询链路可见。

**独立测试**：调用各查询接口，验证板件实体中包含真实包号字段。

**验收场景**：

1. **给定** 板件已有真实包号，**当** 查询批次层级，**则** 返回的板件实体包含真实包号且值正确
2. **给定** 板件已有真实包号，**当** 查询包装层级，**则** 返回的板件实体包含真实包号且值正确
3. **给定** 板件已有真实包号，**当** 查询板件详情，**则** 返回的板件实体包含真实包号且值正确

---

### 用户故事 3 - 空值与覆盖规则一致（优先级：P3）

系统在真实包号为空或重复提交时保持一致的覆盖规则，避免数据混乱。

**优先级原因**：确保数据一致性，避免误覆盖或空值污染。

**独立测试**：用不同报工请求组合验证覆盖规则。

**验收场景**：

1. **给定** 板件已有真实包号，**当** 报工提交真实包号为空，**则** 保留原值不变
2. **给定** 板件已有真实包号，**当** 报工提交新的真实包号，**则** 以最新提交值为准

---

### 边界情况

- 当真实包号超出系统允许长度时应如何处理（拒绝或截断）
- 当提交的真实包号与现有包号冲突（不同值）时系统如何记录与覆盖

## 需求（必须）

### 功能性需求

- **FR-001**：系统必须在板件数据中新增“真实打包包号”字段，用于存储实际打包包号
- **FR-002**：系统必须在板件报工提交时支持传入真实包号
- **FR-003**：系统必须在报工提交成功后将真实包号写入对应板件记录
- **FR-004**：系统必须在批次层级查询中返回板件的真实包号字段
- **FR-005**：系统必须在包装层级查询中返回板件的真实包号字段
- **FR-006**：系统必须在板件详情查询中返回真实包号字段
- **FR-007**：系统必须在真实包号为空的情况下保持字段为空且不影响其他字段返回
- **FR-008**：系统必须在提交真实包号时遵循统一覆盖规则（以最新提交值为准）

### 关键实体（如涉及数据）

- **板件（Part）**：新增真实包号字段；与报工请求及查询返回关联
- **板件报工请求**：新增真实包号入参，用于更新板件数据

### 假设与依赖

- 真实包号为可空文本字段，长度满足业务需要
- 当报工请求未传真实包号时，不覆盖已有真实包号

## 成功标准（必须）

### 可衡量指标

- **SC-001**：100% 的板件查询结果均包含真实包号字段（允许为空）
- **SC-002**：报工提交包含真实包号时，5 秒内通过任一查询接口可看到该值
- **SC-003**：真实包号更新成功率达到 99%（在正常报工流程中）
- **SC-004**：用户能够在 3 分钟内完成“报工录入真实包号并查询验证”的全流程
